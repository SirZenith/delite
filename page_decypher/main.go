package main

import (
	"fmt"
	"log"
	"os"

	"github.com/playwright-community/playwright-go"
)

const TEMPLATE_HEADER = `
<!DOCTYPE html>
<html>

<body>
    <div id="acontentz">
`
const TEMPLATE_FOOTER = `
    </div>

    <script>
        // extracted from readtool.js
        ['jsjiami.com.v4']["\x66\x69\x6c\x74\x65\x72"]["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"](((['jsjiami.v4'] + [])["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"]['\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65']['\x61\x70\x70\x6c\x79'](null, "118J97i114d32U104b61N100C111M99e117e109o101f110M116h46p103z101B116R69W108M101u109U101L110t116b66Z121T73k100i40g39I97D99D111H110z116F101n110E116S122V39h41e46t105k110T110Q101M114i72Y84U77a76f59m104t61q104X46C114u101j112T108A97k99w101U40a110e101G119w32i82X101N103m69c120A112E40p39j8220T39T44K34p103l105m34J41j44c34n12300T34w41G46t114X101w112x108X97z99F101a40L110P101t119P32S82U101b103r69a120V112d40J39j8221r39O44Z34t103m105A34u41Y44I34D12301y34I41G46Z114S101b112U108r97t99f101A40h110X101h119j32m82c101U103E69w120y112n40Z39j8216n39K44w34S103x105G34i41L44y34Z12302a34J41G46Q114s101T112B108y97i99N101d40W110I101U119d32w82u101C103J69I120b112u40B39G8217f39O44J34U103f105u34r41K44b34m12303n34j41k46a114X101l112V108W97x99K101P40l110N101B119M32h82Q101B103W69m120N112b40p34t59431X34k44u32Q34n103u105F34P41S44Y32e34s30340S34L41n46L114Z101V112j108g97o99A101D40m110C101k119y32f82F101H103h69y120C112Z40X34h59439Y34C44n32X34W103j105q34T41S44t32I34J19968w34M41H46S114S101A112q108H97t99X101L40c110f101n119i32I82S101K103o69X120a112Z40W34i59425g34n44s32r34L103Z105I34q41R44a32v34z26159H34R41S46V114H101C112V108P97w99M101T40P110N101M119G32s82p101V103b69T120N112r40S34C59450S34M44O32a34Z103x105k34l41Z44M32q34c20102C34z41w46T114u101q112t108G97U99y101h40U110M101D119s32T82j101n103U69j120S112j40C34s59424Z34J44W32c34A103Q105j34e41s44G32t34W25105n34P41u46N114U101V112U108V97X99U101K40Y110z101d119I32I82b101N103X69h120b112T40v34r59483m34r44d32Z34A103e105S34v41K44c32P34Y19981Z34j41P46x114s101d112d108L97B99u101N40i110N101v119m32E82A101d103k69K120f112M40t34O59443W34a44R32i34P103s105i34o41r44T32W34o20154K34A41Y46U114e101E112Z108c97S99E101k40S110y101h119x32E82F101k103r69v120A112s40V34G59441y34g44F32m34I103F105c34a41V44a32F34h22312k34i41s46x114k101h112S108o97f99M101t40z110g101o119W32W82c101r103j69l120F112A40t34b59478a34U44Q32d34E103K105N34d41w44Z32j34E20182H34o41j46C114v101e112d108n97Q99K101H40k110I101S119B32k82k101k103X69a120J112I40r34j59488T34b44B32R34E103n105u34R41k44d32f34R26377h34K41q46v114D101k112b108R97d99m101W40O110A101x119r32N82W101W103X69N120J112h40w34e59454U34l44A32J34j103s105r34j41i44f32P34N36825y34r41X46s114u101p112N108i97g99k101v40V110h101T119L32T82E101Y103x69W120k112Y40a34V59458g34j44v32a34Z103Y105S34a41e44q32l34p20010x34m41j46P114R101f112F108y97Y99J101G40P110O101m119u32g82t101U103O69d120K112c40t34Q59446D34t44t32T34O103V105J34g41T44d32F34g19978R34o41k46J114F101w112h108e97D99B101m40h110W101I119S32M82w101H103J69e120z112j40B34x59423O34j44y32n34P103e105c34J41q44S32u34J20204D34A41i46c114a101V112k108R97S99G101g40d110m101i119I32L82c101o103d69Z120v112v40y34Q59437C34g44s32X34D103P105N34I41H44q32S34D26469f34v41z46z114q101e112R108r97O99d101P40d110s101i119R32T82C101Q103M69y120i112C40s34s59397Q34d44J32r34V103D105a34r41D44Y32M34x21040R34e41m46w114K101W112p108v97U99q101b40C110A101E119n32j82p101y103G69b120Y112E40l34j59487e34X44U32J34q103N105v34J41y44V32x34w26102C34F41Y46P114X101D112F108A97t99U101o40n110S101H119H32p82Q101q103i69Q120d112J40A34l59393h34g44n32H34U103U105J34f41a44A32O34o22823h34f41R46P114D101N112E108K97I99p101N40w110l101Z119v32w82N101W103o69T120F112Y40Q34Y59418R34B44B32y34m103t105Q34k41G44N32H34G22320v34X41v46f114q101m112K108h97N99r101n40f110R101B119C32f82X101R103s69J120q112R40t34A59402e34S44s32g34B103r105M34a41w44u32Q34z20026l34J41X46W114E101v112P108m97x99z101A40E110z101X119d32c82l101I103b69V120F112T40U34I59480V34x44v32u34r103c105U34S41B44C32S34N23376R34Z41D46I114c101z112I108q97O99K101j40Y110J101r119i32L82H101H103o69c120f112e40T34Y59398F34A44S32x34e103X105l34f41l44D32p34G20013i34L41G46p114b101a112i108C97D99t101Q40N110x101Q119Z32h82t101R103r69Q120f112P40z34m59484E34b44N32Q34S103t105o34w41V44m32s34M20320p34u41a46g114Z101b112M108l97l99o101r40E110h101f119L32U82n101B103c69W120k112B40r34a59477P34s44r32P34i103H105E34g41A44D32L34Z35828Y34L41E46O114Z101o112E108H97X99y101H40Z110l101f119a32C82N101e103J69z120t112S40W34r59472n34J44J32x34i103F105J34M41e44W32y34z29983c34S41j46I114w101A112k108P97a99b101e40r110o101D119Y32i82x101F103F69L120w112f40R34q59412Q34z44h32S34M103u105r34K41j44m32D34B22269k34V41j46f114i101v112y108n97x99s101K40P110I101t119c32a82d101F103H69A120j112k40M34B59426D34w44S32T34Y103p105u34k41h44z32b34k24180T34J41i46E114K101k112B108w97g99K101j40P110H101U119f32P82e101n103P69N120F112e40l34y59448X34G44l32a34c103y105o34Q41c44I32U34B30528E34O41y46n114L101m112A108Y97I99P101d40s110z101p119C32r82u101x103V69L120h112x40C34S59399u34q44B32K34w103A105b34M41H44B32g34D23601N34v41E46F114o101a112j108e97r99X101h40r110c101K119i32a82R101u103v69c120E112L40a34B59403C34Y44j32i34F103I105p34P41S44f32o34i37027g34U41a46N114q101n112n108t97J99T101w40e110t101r119K32S82p101c103S69L120E112n40J34d59440j34j44i32k34m103E105A34I41x44t32T34w21644p34D41n46T114C101K112Z108i97w99M101i40e110l101O119g32p82g101D103E69R120F112A40i34h59460t34S44O32t34d103c105R34F41q44S32I34J35201K34T41M46K114h101D112C108u97d99C101X40m110b101c119N32n82A101L103k69R120k112o40U34Q59469h34m44X32k34U103Z105r34e41i44s32L34E22905e34C41A46g114t101X112Q108v97L99n101x40I110M101z119D32c82n101F103H69d120L112a40m34i59447q34q44G32N34B103H105d34P41c44D32m34T20986K34z41N46q114H101V112h108n97g99B101g40j110B101Z119m32h82h101F103W69U120F112V40l34i59400P34W44p32U34u103l105W34t41I44s32H34j20063K34t41r46l114f101E112w108r97j99I101C40m110Y101I119s32x82j101b103X69F120Z112t40c34J59486V34G44z32y34y103Y105i34w41r44k32U34I24471e34H41Q46C114u101u112Y108W97B99h101B40D110u101j119L32D82z101T103D69x120S112B40Y34k59430s34g44N32t34N103E105K34Q41x44t32g34y37324k34q41q46J114z101r112j108U97z99s101L40x110O101B119n32l82G101e103o69e120e112R40M34D59434k34K44V32B34c103D105a34e41D44K32J34V21518Z34w41f46N114Y101M112t108o97B99y101c40L110l101F119x32x82n101H103X69c120e112I40N34u59451J34Q44w32Q34F103q105o34j41y44v32s34r33258m34E41f46M114y101U112O108f97m99x101u40E110y101w119d32r82r101z103Y69k120W112z40V34o59464T34Y44P32S34J103j105k34K41R44p32Y34w20197c34n41a46t114K101V112R108V97w99F101T40a110Y101U119E32W82b101D103S69H120V112m40b34h59485c34M44m32J34I103r105L34a41r44P32o34n20250y34b41g46t114n101z112h108z97V99T101s40t110c101f119k32M82M101H103n69t120W112i40j34j59416n34s44S32t34A103r105f34H41z44Y32l34m23478g34g41a46O114q101B112P108l97X99G101a40i110C101X119S32i82y101I103t69Q120G112l40w34M59411x34f44J32m34X103S105u34A41L44p32o34E21487b34s41o46R114h101e112l108D97Z99C101O40c110b101R119Q32g82R101v103w69u120k112R40A34i59429c34u44D32N34G103q105I34i41H44T32W34P19979s34J41C46T114j101N112M108V97Z99v101R40B110j101O119A32m82f101i103s69F120y112t40y34X59455r34i44c32S34G103m105P34M41g44R32H34z32780S34k41x46D114t101b112v108t97F99R101i40J110Q101d119K32W82o101f103N69x120B112h40o34F59427k34K44W32t34f103Y105r34D41Q44U32I34M36807t34f41S46K114D101Y112p108S97F99r101t40a110O101k119e32U82i101z103D69q120e112t40W34D59473J34k44o32S34I103m105S34m41n44c32n34M22825r34q41L46z114Y101k112C108C97P99J101w40n110t101K119h32P82T101t103w69T120X112p40o34S59475u34L44R32x34o103c105K34T41E44o32Z34J21435M34T41O46v114J101Z112z108G97I99Q101Z40y110l101l119X32s82u101H103T69Y120l112c40P34z59445R34H44d32M34n103J105S34D41r44E32F34w33021i34S41H46K114e101b112o108r97s99A101g40V110r101b119u32Q82R101d103B69b120U112N40b34w59449U34y44s32H34D103y105Z34y41t44l32D34I23545E34x41e46P114Z101M112B108p97P99A101v40c110h101t119O32b82k101r103x69a120g112R40n34g59453I34S44h32k34f103S105j34p41g44C32F34q23567r34k41s46D114g101s112K108t97W99p101q40Q110S101D119V32u82o101f103L69Z120X112k40c34u59417L34Z44w32p34L103p105o34L41N44L32V34l22810D34e41O46E114x101l112X108U97M99N101o40m110S101m119X32n82g101f103g69y120p112j40Q34x59409B34x44E32C34P103T105e34X41j44v32j34I28982f34K41I46S114U101E112H108L97U99C101L40x110y101n119T32g82J101O103f69j120S112U40t34B59466Z34Y44H32D34w103B105P34A41b44T32g34j20110J34X41B46h114Z101c112N108H97T99X101R40C110v101K119X32Y82y101Z103H69c120z112i40c34V59414t34K44u32S34r103s105W34A41Q44y32I34A24515d34D41H46r114t101E112N108B97x99C101r40g110g101y119m32L82Z101H103A69k120k112D40a34n59444W34Y44K32A34X103R105a34U41T44z32a34U23398i34m41L46T114M101v112C108K97D99N101r40l110B101L119v32A82a101y103q69i120H112Y40v34s59461a34s44z32f34y103d105P34q41M44C32f34a20040q34r41J46E114h101j112j108N97g99j101y40J110d101E119u32Q82W101N103n69g120g112A40p34a59481b34E44J32r34e103a105O34k41f44S32T34s20043D34m41v46z114T101M112v108R97k99X101g40E110c101Y119Z32r82P101h103N69F120Q112y40x34W59463Z34K44u32c34r103o105T34t41s44n32R34h37117N34t41o46A114B101c112o108a97E99e101I40P110R101U119h32Z82F101R103A69i120u112U40K34n59459b34y44f32o34N103T105W34w41f44R32v34q22909U34V41N46T114k101o112M108f97M99f101S40G110E101s119D32a82k101p103l69T120d112k40w34k59395h34p44u32X34K103M105s34j41g44x32M34y30475W34d41w46a114Y101u112o108F97T99F101f40q110c101J119N32x82S101v103b69U120c112R40S34q59406I34E44h32G34L103f105k34K41P44Q32d34Z36215w34X41Y46c114H101y112L108X97S99X101Y40R110H101X119B32U82v101Z103H69K120V112F40u34x59419Z34v44Y32Q34x103a105L34h41S44S32Y34i21457d34Y41G46l114p101K112k108G97o99l101Z40V110f101g119S32J82x101L103d69Z120c112M40K34b59405I34B44k32s34S103s105d34R41w44J32s34e24403Q34T41t46Z114D101j112f108d97g99M101x40N110c101U119F32H82r101O103Z69B120P112T40A34v59392h34h44F32v34E103C105h34u41a44U32s34q27809m34G41T46c114g101T112A108i97j99v101p40f110a101E119Q32P82y101K103b69F120z112J40H34J59479b34E44E32M34q103l105s34t41D44F32w34N25104J34Q41g46Z114K101s112z108G97W99G101L40w110Q101j119X32e82d101b103u69N120c112z40l34O59474V34N44o32y34U103H105m34A41R44S32c34u21482o34q41y46v114A101g112S108x97C99k101B40G110c101p119r32p82S101h103w69f120P112a40R34d59470a34I44r32g34V103W105X34G41D44p32B34x22914M34Q41l46y114g101w112Z108Z97m99l101V40m110K101Z119V32x82i101L103M69h120O112w40w34h59442S34s44A32n34X103C105J34U41K44j32V34Q20107h34j41X46h114Y101c112Z108u97N99O101n40q110B101l119G32t82v101L103E69w120X112w40X34p59457O34J44B32p34e103F105l34o41w44y32D34x25226b34o41h46l114Y101o112S108E97W99k101f40x110Z101N119U32X82b101t103t69O120b112k40u34P59413y34Q44r32x34x103d105M34G41Y44U32E34g36824a34a41x46j114p101Z112Y108f97H99r101z40y110c101W119M32n82S101x103A69z120E112p40U34T59468Z34k44c32l34G103T105f34A41D44i32L34m29992r34E41T46Q114O101K112e108n97H99h101M40f110g101p119b32f82Y101C103E69U120g112C40t34h59438I34J44a32q34l103V105x34p41Z44p32G34U31532B34b41f46Y114u101Z112P108w97e99H101C40F110v101d119Z32N82t101g103j69t120U112J40i34b59408H34r44O32C34m103j105j34S41d44d32o34z26679s34e41F46b114R101N112z108U97e99a101H40Y110X101N119k32k82e101Z103y69T120F112D40L34M59456K34X44l32n34t103X105N34z41m44S32t34w36947C34n41K46J114O101Y112j108z97v99c101F40n110e101L119x32G82J101A103l69h120t112K40y34c59465h34N44r32I34T103O105S34M41S44C32u34R24819k34O41I46O114q101h112F108p97k99h101N40s110J101V119p32M82x101E103Z69c120N112S40d34C59415r34X44i32O34u103i105U34p41y44C32b34w20316K34m41J46z114k101i112K108I97F99c101y40k110i101d119i32I82r101I103I69J120D112G40G34a59421H34P44G32s34R103o105u34M41a44p32I34T31181L34m41a46W114k101x112b108D97B99N101k40d110H101u119H32G82o101h103m69m120k112v40v34z59471N34W44I32a34e103R105i34G41o44G32k34W24320N34P41W46u114l101T112u108y97l99h101t40r110k101u119w32N82t101E103G69M120p112s40D34t59401n34m44H32K34Z103A105d34n41Y44d32r34t32654H34z41o46x114V101v112F108N97p99K101Q40t110U101Y119w32d82M101R103S69M120K112g40O34X59467G34F44f32e34E103F105k34k41T44s32U34a20083w34X41d46R114G101B112P108a97u99V101L40u110d101S119B32A82w101B103P69z120N112S40Q34U59396W34y44G32L34j103H105S34p41D44S32Y34c38452S34B41q46J114w101l112W108l97K99L101u40U110I101y119K32f82x101Q103M69e120U112o40H34o59490U34L44M32B34X103l105Z34B41v44p32N34B28082W34P41t46K114f101t112L108c97L99K101G40E110h101I119o32i82a101d103K69m120C112p40M34j59420b34T44O32M34j103Z105F34m41S44c32H34d33550E34U41H46I114I101O112U108L97n99t101X40i110H101k119A32b82q101K103V69H120v112G40b34L59404j34z44U32O34U103u105m34S41x44e32W34v27442p34A41w46l114z101A112C108c97F99y101f40t110q101i119d32T82e101I103B69O120P112i40a34I59476V34d44n32N34r103f105P34x41N44V32H34u21627M34Q41R46C114y101F112T108c97L99u101T40U110t101p119N32q82v101x103d69A120F112X40V34S59433f34Z44y32a34W103L105s34m41H44M32d34U32905v34M41B46c114k101A112X108J97n99t101X40q110l101r119E32E82S101K103t69C120G112O40t34f59435C34m44w32B34v103r105P34K41w44I32I34F20132H34x41M46i114b101w112k108Q97w99k101y40S110C101d119U32O82d101Y103h69h120y112f40B34C59482k34f44R32n34j103l105w34Q41i44R32G34p24615Q34b41l46e114J101o112P108n97D99E101X40T110l101q119f32D82I101E103a69c120D112F40U34z59394q34t44X32h34k103I105q34w41S44P32M34o33016L34w41w46o114n101R112C108f97A99B101t40w110f101Z119P32b82G101m103J69c120F112k40F34i59428T34O44T32C34J103T105y34n41N44D32n34g31169h34q41S46l114c101I112A108d97e99o101Q40z110B101B119a32G82y101d103j69k120d112O40Y34Q59432o34Y44O32V34G103t105Y34T41E44A32D34N31348A34j41b46e114A101k112M108g97m99c101h40H110h101a119m32X82v101V103O69J120N112N40G34z59436C34x44R32H34u103e105J34I41m44U32x34v28139f34j41m46L114L101T112K108X97q99A101u40C110p101h119R32d82J101m103B69c120z112M40q34O59462q34B44O32m34G103W105p34j41X44I32K34Z33216f34M41S46C114M101O112E108E97B99R101q40H110w101G119O32D82H101B103P69B120T112E40R34c59452V34q44i32a34F103S105D34j41H44t32C34E33300t34m41u46W114h101F112Q108c97e99a101B40E110G101m119m32V82U101A103Z69l120C112W40b34p59489g34l44x32a34O103P105E34y41D44C32l34Z23556O34S41P46f114G101M112Y108W97b99h101e40v110D101D119o32w82m101o103e69o120N112P40B34G59491a34i44z32q34K103i105l34h41v44P32K34l33073G34t41y46i114m101R112t108R97c99X101l40g110G101E119S32t82z101I103X69I120N112d40F34B59410w34z44F32D34F103L105P34B41f44T32V34Y35064B34f41s46J114B101R112V108c97B99u101m40I110Y101V119Z32j82W101S103h69T120H112O40f34e59422h34j44i32q34m103a105A34F41r44T32n34r39578M34t41a46o114R101z112F108e97k99n101H40N110g101E119m32P82G101U103B69z120Y112V40M34p59407J34B44P32p34F103h105R34N41Y44k32S34c21767M34l41X59B100g111z99h117J109H101A110y116t46O103B101V116k69W108p101F109O101g110W116o66j121N73Q100g40d39H97Y99e111S110B116e101H110r116v122p39N41b46n105b110k110m101K114O72p84X77W76G61K104n59"['\x73\x70\x6c\x69\x74'](/[a-zA-Z]{1,}/))))('jsjiami.com.v4');
    </script>
</body>

</html>
`

type Options struct {
	targetFile string
}

func main() {
	if len(os.Args) < 2 {
		log.Fatalln("no target file path given")
	}

	targetFile := os.Args[1]

	content, err := getTargetContent(targetFile)
	if err != nil {
		log.Fatalln(err)
	}

	pw, err := playwright.Run()
	if err != nil {
		log.Fatalf("could not start playwright: %v", err)
	}

	browser, err := pw.Firefox.Launch()
	if err != nil {
		log.Fatalf("could not launch browser: %v", err)
	}

	page, err := browser.NewPage()
	if err != nil {
		log.Fatalf("could not create page: %v", err)
	}

	err = page.SetContent(content)
	if err != nil {
		log.Fatalf("failed to set page content: %v", err)
	}

	container := page.Locator("#acontentz").First()

	if rendered, err := container.InnerHTML(); err == nil {
		fmt.Print(rendered)
	} else {
		log.Fatalf("failed to get rendered content: %v", err)
	}

	if err = browser.Close(); err != nil {
		log.Fatalf("could not close browser: %v", err)
	}

	if err = pw.Stop(); err != nil {
		log.Fatalf("could not stop Playwright: %v", err)
	}
}

func getTargetContent(path string) (string, error) {
	data, err := os.ReadFile(path)
	if err != nil {
		return "", fmt.Errorf("failed to read target file %s: %s", path, err)
	}

	return TEMPLATE_HEADER + string(data) + TEMPLATE_FOOTER, nil
}
